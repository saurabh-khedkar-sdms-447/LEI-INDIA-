"use strict";(()=>{var e={};e.id=2283,e.ids=[2283],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},68703:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>l,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>d,staticGenerationAsyncStorage:()=>c});var s=t(12085),o=t(31650),i=t(85980),n=t(77261),u=e([n]);n=(u.then?(await u)():u)[0];let p=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/users/register/route",pathname:"/api/users/register",filename:"route",bundlePath:"app/api/users/register/route"},resolvedPagePath:"/home/stark/leiindias/app/api/users/register/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:c,serverHooks:d}=p,h="/api/users/register/route";function l(){return(0,i.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:c})}a()}catch(e){a(e)}})},77261:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{POST:()=>c});var s=t(30627),o=t(6415),i=t(67689),n=t(84770),u=t.n(n),l=t(83136),p=t(17261),m=e([l]);l=(m.then?(await m)():m)[0];let d=o.Ry({name:o.Z_().min(2,"Name must be at least 2 characters").trim(),email:o.Z_().email("Invalid email address").toLowerCase().trim(),password:o.Z_().min(8,"Password must be at least 8 characters"),company:o.Z_().min(2,"Company name is required").trim().optional(),phone:o.Z_().min(10,"Please enter a valid phone number").trim().optional()});async function c(e){try{let r=await e.json(),t=d.parse(r);if(((await l.w.query('SELECT 1 FROM "User" WHERE email = $1 LIMIT 1',[t.email])).rowCount??0)>0)return s.NextResponse.json({error:"Email already registered"},{status:400});let a=await i.ZP.hash(t.password,10),o=u().randomBytes(32).toString("hex"),n=new Date;n.setDate(n.getDate()+7);let m=(await l.w.query(`
      INSERT INTO "User" (
        name, email, password, company, phone, role, "isActive",
        "emailVerified", "emailVerificationToken", "emailVerificationTokenExpires"
      )
      VALUES ($1, $2, $3, $4, $5, 'customer', true, false, $6, $7)
      RETURNING id, name, email, company, phone, role
      `,[t.name,t.email,a,t.company??null,t.phone??null,o,n])).rows[0],c=`${process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3000"}/verify-email?token=${o}`;console.log(`Email verification link for ${m.email}: ${c}`);let h=(0,p.R)(m.email,"customer"),f=s.NextResponse.json({user:{id:m.id,name:m.name,email:m.email,company:m.company||void 0,phone:m.phone||void 0,role:m.role},message:"Registration successful. Please check your email to verify your account.",requiresVerification:!0},{status:201});return f.cookies.set("user_token",h,{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:604800}),f}catch(e){if(e?.name==="ZodError")return s.NextResponse.json({error:"Validation failed",details:e.errors?.map(e=>({field:e.path.join("."),message:e.message}))},{status:400});return console.error("Registration error:",e),s.NextResponse.json({error:"Failed to register user"},{status:500})}}a()}catch(e){a(e)}})},17261:(e,r,t)=>{t.d(r,{R:()=>n,W:()=>u});var a=t(57946),s=t.n(a);let o=process.env.JWT_SECRET||"",i=process.env.JWT_EXPIRES_IN||"7d";if(!o)throw Error("JWT_SECRET environment variable must be set in production");function n(e,r="customer"){if(!o)throw Error("JWT_SECRET is not configured");return s().sign({username:e,role:r},o,{expiresIn:i})}function u(e){try{if(!o)return null;return s().verify(e,o)}catch{return null}}},83136:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.d(r,{w:()=>i});var s=t(8678),o=e([s]);if(s=(o.then?(await o)():o)[0],!process.env.DATABASE_URL)throw Error("DATABASE_URL must be set for Postgres connections");let i=new s.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}});a()}catch(e){a(e)}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[6522,8247,7946,6415,7689],()=>t(68703));module.exports=a})();