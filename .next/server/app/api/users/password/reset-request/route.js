"use strict";(()=>{var e={};e.id=8051,e.ids=[8051],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},8678:e=>{e.exports=import("pg")},4842:(e,s,r)=>{r.a(e,async(e,t)=>{try{r.r(s),r.d(s,{originalPathname:()=>m,patchFetch:()=>p,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>w,staticGenerationAsyncStorage:()=>c});var a=r(12085),o=r(31650),n=r(85980),i=r(8401),u=e([i]);i=(u.then?(await u)():u)[0];let d=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/users/password/reset-request/route",pathname:"/api/users/password/reset-request",filename:"route",bundlePath:"app/api/users/password/reset-request/route"},resolvedPagePath:"/home/stark/leiindias/app/api/users/password/reset-request/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:c,serverHooks:w}=d,m="/api/users/password/reset-request/route";function p(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:c})}t()}catch(e){t(e)}})},8401:(e,s,r)=>{r.a(e,async(e,t)=>{try{r.r(s),r.d(s,{POST:()=>d});var a=r(30627),o=r(6415),n=r(83136),i=r(84770),u=r.n(i),p=e([n]);n=(p.then?(await p)():p)[0];let l=o.Ry({email:o.Z_().email("Invalid email address").toLowerCase().trim()});async function d(e){try{let s=await e.json(),r=l.parse(s),t=await n.w.query(`
      SELECT id, email, name
      FROM "User"
      WHERE email = $1 AND "isActive" = true
      LIMIT 1
      `,[r.email]);if(0===t.rows.length)return a.NextResponse.json({message:"If an account exists with this email, a password reset link has been sent."});let o=t.rows[0],i=u().randomBytes(32).toString("hex"),p=new Date;p.setHours(p.getHours()+1),await n.w.query(`
      UPDATE "PasswordResetToken"
      SET used = true
      WHERE "userId" = $1 AND used = false
      `,[o.id]),await n.w.query(`
      INSERT INTO "PasswordResetToken" ("userId", token, "expiresAt")
      VALUES ($1, $2, $3)
      `,[o.id,i,p]);let d=`${process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3000"}/reset-password?token=${i}`;return console.log(`Password reset link for ${o.email}: ${d}`),a.NextResponse.json({message:"If an account exists with this email, a password reset link has been sent."})}catch(e){if(e?.name==="ZodError")return a.NextResponse.json({error:"Validation failed",details:e.errors?.map(e=>({field:e.path.join("."),message:e.message}))},{status:400});return console.error("Password reset request error:",e),a.NextResponse.json({error:"Failed to process password reset request"},{status:500})}}t()}catch(e){t(e)}})},83136:(e,s,r)=>{r.a(e,async(e,t)=>{try{r.d(s,{w:()=>n});var a=r(8678),o=e([a]);if(a=(o.then?(await o)():o)[0],!process.env.DATABASE_URL)throw Error("DATABASE_URL must be set for Postgres connections");let n=new a.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}});t()}catch(e){t(e)}})}};var s=require("../../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[6522,8247,6415],()=>r(4842));module.exports=t})();