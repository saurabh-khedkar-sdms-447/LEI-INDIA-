"use strict";(()=>{var e={};e.id=572,e.ids=[572],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},8678:e=>{e.exports=import("pg")},2822:(e,r,s)=>{s.a(e,async(e,t)=>{try{s.r(r),s.d(r,{originalPathname:()=>h,patchFetch:()=>d,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>l,staticGenerationAsyncStorage:()=>w});var a=s(12085),o=s(31650),n=s(85980),i=s(16948),u=e([i]);i=(u.then?(await u)():u)[0];let p=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/users/password/reset/route",pathname:"/api/users/password/reset",filename:"route",bundlePath:"app/api/users/password/reset/route"},resolvedPagePath:"/home/stark/leiindias/app/api/users/password/reset/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:c,staticGenerationAsyncStorage:w,serverHooks:l}=p,h="/api/users/password/reset/route";function d(){return(0,n.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:w})}t()}catch(e){t(e)}})},16948:(e,r,s)=>{s.a(e,async(e,t)=>{try{s.r(r),s.d(r,{POST:()=>d});var a=s(30627),o=s(6415),n=s(67689),i=s(83136),u=e([i]);i=(u.then?(await u)():u)[0];let p=o.Ry({token:o.Z_().min(1,"Reset token is required"),password:o.Z_().min(8,"Password must be at least 8 characters")});async function d(e){try{let r=await e.json(),s=p.parse(r),t=await i.w.query(`
      SELECT id, "userId", "expiresAt", used
      FROM "PasswordResetToken"
      WHERE token = $1
      LIMIT 1
      `,[s.token]);if(0===t.rows.length)return a.NextResponse.json({error:"Invalid or expired reset token"},{status:400});let o=t.rows[0];if(o.used||new Date>new Date(o.expiresAt))return a.NextResponse.json({error:"Invalid or expired reset token"},{status:400});let u=await n.ZP.hash(s.password,10);return await i.w.query(`
      UPDATE "User"
      SET password = $1, "updatedAt" = NOW()
      WHERE id = $2
      `,[u,o.userId]),await i.w.query(`
      UPDATE "PasswordResetToken"
      SET used = true
      WHERE id = $1
      `,[o.id]),a.NextResponse.json({message:"Password has been reset successfully"})}catch(e){if(e?.name==="ZodError")return a.NextResponse.json({error:"Validation failed",details:e.errors?.map(e=>({field:e.path.join("."),message:e.message}))},{status:400});return console.error("Password reset error:",e),a.NextResponse.json({error:"Failed to reset password"},{status:500})}}t()}catch(e){t(e)}})},83136:(e,r,s)=>{s.a(e,async(e,t)=>{try{s.d(r,{w:()=>n});var a=s(8678),o=e([a]);if(a=(o.then?(await o)():o)[0],!process.env.DATABASE_URL)throw Error("DATABASE_URL must be set for Postgres connections");let n=new a.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}});t()}catch(e){t(e)}})}};var r=require("../../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[6522,8247,6415,7689],()=>s(2822));module.exports=t})();