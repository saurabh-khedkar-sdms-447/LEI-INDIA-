"use strict";(()=>{var e={};e.id=9373,e.ids=[9373],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},9937:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>p,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var o=t(12085),a=t(31650),i=t(85980),n=t(90955),u=e([n]);n=(u.then?(await u)():u)[0];let l=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/users/login/route",pathname:"/api/users/login",filename:"route",bundlePath:"app/api/users/login/route"},resolvedPagePath:"/home/stark/leiindias/app/api/users/login/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:c,staticGenerationAsyncStorage:d,serverHooks:m}=l,h="/api/users/login/route";function p(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}s()}catch(e){s(e)}})},90955:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{POST:()=>l});var o=t(30627),a=t(6415),i=t(67689),n=t(83136),u=t(17261),p=e([n]);n=(p.then?(await p)():p)[0];let c=a.Ry({email:a.Z_().email("Invalid email address").toLowerCase().trim(),password:a.Z_().min(1,"Password is required")});async function l(e){try{let r=await e.json(),t=c.parse(r),s=(await n.w.query(`
      SELECT id, name, email, password, company, phone, role, "isActive", "emailVerified"
      FROM "User"
      WHERE email = $1
      LIMIT 1
      `,[t.email])).rows[0];if(!s)return o.NextResponse.json({error:"Invalid email or password"},{status:401});if(!s.isActive)return o.NextResponse.json({error:"Account is deactivated"},{status:403});if(!await i.ZP.compare(t.password,s.password))return o.NextResponse.json({error:"Invalid email or password"},{status:401});let a=(0,u.R)(s.email,"customer"),p=o.NextResponse.json({user:{id:s.id,name:s.name,email:s.email,company:s.company||void 0,phone:s.phone||void 0,role:s.role}});return p.cookies.set("user_token",a,{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:604800}),p}catch(e){if(e?.name==="ZodError")return o.NextResponse.json({error:"Validation failed",details:e.errors?.map(e=>({field:e.path.join("."),message:e.message}))},{status:400});return console.error("Login error:",e),o.NextResponse.json({error:"Failed to authenticate user"},{status:500})}}s()}catch(e){s(e)}})},17261:(e,r,t)=>{t.d(r,{R:()=>n,W:()=>u});var s=t(57946),o=t.n(s);let a=process.env.JWT_SECRET||"",i=process.env.JWT_EXPIRES_IN||"7d";if(!a)throw Error("JWT_SECRET environment variable must be set in production");function n(e,r="customer"){if(!a)throw Error("JWT_SECRET is not configured");return o().sign({username:e,role:r},a,{expiresIn:i})}function u(e){try{if(!a)return null;return o().verify(e,a)}catch{return null}}},83136:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{w:()=>i});var o=t(8678),a=e([o]);if(o=(a.then?(await a)():a)[0],!process.env.DATABASE_URL)throw Error("DATABASE_URL must be set for Postgres connections");let i=new o.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}});s()}catch(e){s(e)}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[6522,8247,7946,6415,7689],()=>t(9937));module.exports=s})();