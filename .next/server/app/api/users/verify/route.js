"use strict";(()=>{var e={};e.id=9074,e.ids=[9074],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},81582:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>p,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>v,staticGenerationAsyncStorage:()=>l});var n=t(12085),s=t(31650),i=t(85980),a=t(69439),u=e([a]);a=(u.then?(await u)():u)[0];let c=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/users/verify/route",pathname:"/api/users/verify",filename:"route",bundlePath:"app/api/users/verify/route"},resolvedPagePath:"/home/stark/leiindias/app/api/users/verify/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:v}=c,m="/api/users/verify/route";function p(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:l})}o()}catch(e){o(e)}})},69439:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{POST:()=>u});var n=t(30627),s=t(83136),i=t(17261),a=e([s]);async function u(e){try{let r=e.cookies.get("user_token")?.value;if(!r)return n.NextResponse.json({error:"No token provided"},{status:401});let t=(0,i.W)(r);if(!t)return n.NextResponse.json({error:"Invalid token"},{status:401});let o=(await s.w.query(`
      SELECT id, name, email, company, phone, role, "isActive"
      FROM "User"
      WHERE email = $1
      LIMIT 1
      `,[t.username])).rows[0];if(!o||!o.isActive)return n.NextResponse.json({error:"User not found or inactive"},{status:401});return n.NextResponse.json({valid:!0,user:{id:o.id,name:o.name,email:o.email,company:o.company||void 0,phone:o.phone||void 0,role:o.role}})}catch{return n.NextResponse.json({error:"Token verification failed"},{status:401})}}s=(a.then?(await a)():a)[0],o()}catch(e){o(e)}})},17261:(e,r,t)=>{t.d(r,{R:()=>a,W:()=>u});var o=t(57946),n=t.n(o);let s=process.env.JWT_SECRET||"",i=process.env.JWT_EXPIRES_IN||"7d";if(!s)throw Error("JWT_SECRET environment variable must be set in production");function a(e,r="customer"){if(!s)throw Error("JWT_SECRET is not configured");return n().sign({username:e,role:r},s,{expiresIn:i})}function u(e){try{if(!s)return null;return n().verify(e,s)}catch{return null}}},83136:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.d(r,{w:()=>i});var n=t(8678),s=e([n]);if(n=(s.then?(await s)():s)[0],!process.env.DATABASE_URL)throw Error("DATABASE_URL must be set for Postgres connections");let i=new n.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}});o()}catch(e){o(e)}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[6522,8247,7946],()=>t(81582));module.exports=o})();