"use strict";(()=>{var e={};e.id=9961,e.ids=[9961],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},80682:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>l,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var a=t(12085),o=t(31650),s=t(85980),i=t(49545),u=e([i]);i=(u.then?(await u)():u)[0];let c=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/categories/route",pathname:"/api/categories",filename:"route",bundlePath:"app/api/categories/route"},resolvedPagePath:"/home/stark/leiindias/app/api/categories/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:m}=c,g="/api/categories/route";function l(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}n()}catch(e){n(e)}})},49545:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{GET:()=>l,POST:()=>c});var a=t(30627),o=t(83136),s=t(17494),i=t(29802),u=e([o]);async function l(e){try{let{searchParams:r}=new URL(e.url),t=Math.max(1,parseInt(r.get("page")||"1",10)||1),n=Math.min(100,Math.max(1,parseInt(r.get("limit")||"50",10)||50)),s=(t-1)*n,i=r.get("search"),u=[],l="";i&&(u.push(`%${i}%`),u.push(`%${i}%`),u.push(`%${i}%`),l=`
        WHERE
          name ILIKE $1
          OR slug ILIKE $2
          OR description ILIKE $3
      `);let c=await o.w.query(`
      SELECT COUNT(*)::int AS total
      FROM "Category"
      ${l}
      `,u),p=c.rows[0]?.total??0,d=[...u,n,s],m=(await o.w.query(`
      SELECT id, name, slug, description, image, "parentId", "createdAt", "updatedAt"
      FROM "Category"
      ${l}
      ORDER BY "createdAt" ASC
      LIMIT $${d.length-1}
      OFFSET $${d.length}
      `,d)).rows;return a.NextResponse.json({categories:m,pagination:{page:t,limit:n,total:p,totalPages:Math.ceil(p/n),hasNext:t<Math.ceil(p/n),hasPrev:t>1}})}catch(e){return console.error("Error fetching categories:",e),a.NextResponse.json({error:"Failed to fetch categories"},{status:500})}}o=(u.then?(await u)():u)[0];let c=(0,i.kF)(async e=>{try{let r=await e.json(),t=s.$.parse(r),n=await o.w.query(`
      INSERT INTO "Category" (
        name, slug, description, image, "parentId", "createdAt", "updatedAt"
      )
      VALUES ($1, $2, $3, $4, $5, NOW(), NOW())
      RETURNING id, name, slug, description, image, "parentId", "createdAt", "updatedAt"
      `,[t.name,t.slug,t.description??null,t.image??null,t.parentId??null]);return a.NextResponse.json(n.rows[0],{status:201})}catch(e){if(e?.name==="ZodError")return a.NextResponse.json({error:"Validation failed",details:e.errors?.map(e=>({field:e.path.join("."),message:e.message}))},{status:400});return console.error("Error creating category:",e),a.NextResponse.json({error:"Failed to create category"},{status:400})}});n()}catch(e){n(e)}})},29802:(e,r,t)=>{t.d(r,{$t:()=>l,Ax:()=>i,kF:()=>u});var n=t(30627),a=t(17261);function o(e,r={}){let{requireAuth:t=!0,allowedRoles:n,tokenType:o="user_token"}=r,s=e.cookies.get(o)?.value;if(!s)return null;let i=(0,a.W)(s);return i?n&&n.length>0&&!n.includes(i.role)?null:{username:i.username,role:i.role}:null}function s(e="Forbidden"){return n.NextResponse.json({error:e},{status:403})}function i(e){return o(e,{requireAuth:!0,allowedRoles:["admin","superadmin"],tokenType:"admin_token"})||s("Admin access required")}function u(e){return async r=>{let t=o(r,{requireAuth:!0,allowedRoles:["admin","superadmin"],tokenType:"admin_token"});return t?e(r,t):s("Admin access required")}}function l(e){return async r=>{let t=o(r,{requireAuth:!0,allowedRoles:["customer"],tokenType:"user_token"});return t?e(r,t):function(e="Unauthorized"){return n.NextResponse.json({error:e},{status:401})}("Authentication required")}}},17494:(e,r,t)=>{t.d(r,{$:()=>a,C:()=>o});var n=t(6415);let a=n.Ry({name:n.Z_().min(1,"Category name is required").trim(),slug:n.Z_().min(1,"Slug is required").regex(/^[a-z0-9-]+$/,{message:"Slug must contain only lowercase letters, numbers, and hyphens"}).trim(),description:n.Z_().optional(),image:n.Z_().url().optional().or(n.i0("")),parentId:n.Z_().optional()}),o=a.partial()},17261:(e,r,t)=>{t.d(r,{R:()=>i,W:()=>u});var n=t(57946),a=t.n(n);let o=process.env.JWT_SECRET||"",s=process.env.JWT_EXPIRES_IN||"7d";if(!o)throw Error("JWT_SECRET environment variable must be set in production");function i(e,r="customer"){if(!o)throw Error("JWT_SECRET is not configured");return a().sign({username:e,role:r},o,{expiresIn:s})}function u(e){try{if(!o)return null;return a().verify(e,o)}catch{return null}}},83136:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.d(r,{w:()=>s});var a=t(8678),o=e([a]);if(a=(o.then?(await o)():o)[0],!process.env.DATABASE_URL)throw Error("DATABASE_URL must be set for Postgres connections");let s=new a.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}});n()}catch(e){n(e)}})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[6522,8247,7946,6415],()=>t(80682));module.exports=n})();