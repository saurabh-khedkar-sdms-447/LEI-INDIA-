"use strict";(()=>{var e={};e.id=7840,e.ids=[7840],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},19219:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>p,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var o=t(12085),a=t(31650),s=t(85980),i=t(64309),u=e([i]);i=(u.then?(await u)():u)[0];let c=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/auth/login/route",pathname:"/api/admin/auth/login",filename:"route",bundlePath:"app/api/admin/auth/login/route"},resolvedPagePath:"/home/stark/leiindias/app/api/admin/auth/login/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:m}=c,h="/api/admin/auth/login/route";function p(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}n()}catch(e){n(e)}})},64309:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{POST:()=>p});var o=t(30627),a=t(83136),s=t(67689),i=t(17261),u=e([a]);async function p(e){try{let{username:r,password:t}=await e.json();if(!r||!t)return o.NextResponse.json({error:"Username and password are required"},{status:400});let n=(await a.w.query(`
      SELECT id, username, password, role
      FROM "Admin"
      WHERE username = $1
      LIMIT 1
      `,[r])).rows[0];if(!n||!await s.ZP.compare(t,n.password))return o.NextResponse.json({error:"Invalid credentials"},{status:401});let u=(0,i.R)(n.username,n.role),p=o.NextResponse.json({user:{username:n.username,role:n.role}});return p.cookies.set("admin_token",u,{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:28800}),p}catch(r){console.error("Login error:",r);let e=r instanceof Error?r.message:"Unknown error";return o.NextResponse.json({error:`Failed to authenticate: ${e}`},{status:500})}}a=(u.then?(await u)():u)[0],n()}catch(e){n(e)}})},17261:(e,r,t)=>{t.d(r,{R:()=>i,W:()=>u});var n=t(57946),o=t.n(n);let a=process.env.JWT_SECRET||"",s=process.env.JWT_EXPIRES_IN||"7d";if(!a)throw Error("JWT_SECRET environment variable must be set in production");function i(e,r="customer"){if(!a)throw Error("JWT_SECRET is not configured");return o().sign({username:e,role:r},a,{expiresIn:s})}function u(e){try{if(!a)return null;return o().verify(e,a)}catch{return null}}},83136:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.d(r,{w:()=>s});var o=t(8678),a=e([o]);if(o=(a.then?(await a)():a)[0],!process.env.DATABASE_URL)throw Error("DATABASE_URL must be set for Postgres connections");let s=new o.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}});n()}catch(e){n(e)}})}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[6522,8247,7946,7689],()=>t(19219));module.exports=n})();