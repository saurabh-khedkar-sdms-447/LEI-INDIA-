"use strict";(()=>{var e={};e.id=3440,e.ids=[3440],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},73857:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>R,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>x});var n={};t.r(n),t.d(n,{POST:()=>m});var o=t(12085),i=t(31650),u=t(85980),a=t(30627),s=t(84770);let p=require("fs/promises");var l=t(55315),d=t(29802);let c=(0,l.join)(process.cwd(),"public","uploads");async function m(e){try{let r=(0,d.Ax)(e);if(r instanceof a.NextResponse)return r;let t=(await e.formData()).get("image");if(!(t instanceof File))return a.NextResponse.json({error:"No file uploaded"},{status:400});if(!["image/jpeg","image/png","image/gif","image/webp"].includes(t.type))return a.NextResponse.json({error:"Only image files are allowed (jpeg, png, gif, webp)"},{status:400});let n=await t.arrayBuffer(),o=Buffer.from(n);await (0,p.mkdir)(c,{recursive:!0});let i=t.name.split(".").pop()||"png",u=`product-${Date.now()}-${(0,s.randomUUID)()}.${i}`,m=(0,l.join)(c,u);await (0,p.writeFile)(m,o);let f=`/uploads/${u}`;return a.NextResponse.json({url:f,filename:u,size:o.length})}catch(e){return console.error("Upload error:",e),a.NextResponse.json({error:"Failed to upload image"},{status:500})}}let f=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/upload/route",pathname:"/api/admin/upload",filename:"route",bundlePath:"app/api/admin/upload/route"},resolvedPagePath:"/home/stark/leiindias/app/api/admin/upload/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:x,serverHooks:h}=f,v="/api/admin/upload/route";function R(){return(0,u.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:x})}},29802:(e,r,t)=>{t.d(r,{$t:()=>p,Ax:()=>a,kF:()=>s});var n=t(30627),o=t(17261);function i(e,r={}){let{requireAuth:t=!0,allowedRoles:n,tokenType:i="user_token"}=r,u=e.cookies.get(i)?.value;if(!u)return null;let a=(0,o.W)(u);return a?n&&n.length>0&&!n.includes(a.role)?null:{username:a.username,role:a.role}:null}function u(e="Forbidden"){return n.NextResponse.json({error:e},{status:403})}function a(e){return i(e,{requireAuth:!0,allowedRoles:["admin","superadmin"],tokenType:"admin_token"})||u("Admin access required")}function s(e){return async r=>{let t=i(r,{requireAuth:!0,allowedRoles:["admin","superadmin"],tokenType:"admin_token"});return t?e(r,t):u("Admin access required")}}function p(e){return async r=>{let t=i(r,{requireAuth:!0,allowedRoles:["customer"],tokenType:"user_token"});return t?e(r,t):function(e="Unauthorized"){return n.NextResponse.json({error:e},{status:401})}("Authentication required")}}},17261:(e,r,t)=>{t.d(r,{R:()=>a,W:()=>s});var n=t(57946),o=t.n(n);let i=process.env.JWT_SECRET||"",u=process.env.JWT_EXPIRES_IN||"7d";if(!i)throw Error("JWT_SECRET environment variable must be set in production");function a(e,r="customer"){if(!i)throw Error("JWT_SECRET is not configured");return o().sign({username:e,role:r},i,{expiresIn:u})}function s(e){try{if(!i)return null;return o().verify(e,i)}catch{return null}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[6522,8247,7946],()=>t(73857));module.exports=n})();