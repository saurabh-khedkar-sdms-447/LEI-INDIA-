"use strict";(()=>{var e={};e.id=1986,e.ids=[1986],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},32815:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>c,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var s=t(12085),a=t(31650),o=t(85980),i=t(99598),u=e([i]);i=(u.then?(await u)():u)[0];let l=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/inquiries/route",pathname:"/api/inquiries",filename:"route",bundlePath:"app/api/inquiries/route"},resolvedPagePath:"/home/stark/leiindias/app/api/inquiries/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:m}=l,h="/api/inquiries/route";function c(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}n()}catch(e){n(e)}})},99598:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{GET:()=>d,POST:()=>c});var s=t(30627),a=t(6415),o=t(83136),i=t(29802),u=e([o]);o=(u.then?(await u)():u)[0];let l=a.Ry({name:a.Z_().min(2,"Name must be at least 2 characters").trim(),email:a.Z_().email("Invalid email address").toLowerCase().trim(),phone:a.Z_().min(10,"Phone number must be at least 10 characters").trim().optional(),company:a.Z_().trim().optional(),subject:a.Z_().min(3,"Subject must be at least 3 characters").trim(),message:a.Z_().min(10,"Message must be at least 10 characters").trim()});async function c(e){try{let r=await e.json(),t=l.parse(r),n=await o.w.query(`
      INSERT INTO "Inquiry" (
        name, email, phone, company, subject, message, read, responded,
        "createdAt", "updatedAt"
      )
      VALUES ($1, $2, $3, $4, $5, $6, false, false, NOW(), NOW())
      RETURNING id, name, email, phone, company, subject, message, read, responded,
                "createdAt", "updatedAt"
      `,[t.name,t.email,t.phone??null,t.company??null,t.subject,t.message]);return s.NextResponse.json(n.rows[0],{status:201})}catch(e){if(e?.name==="ZodError")return s.NextResponse.json({error:"Validation failed",details:e.errors?.map(e=>({field:e.path.join("."),message:e.message}))},{status:400});return console.error("Error creating inquiry:",e),s.NextResponse.json({error:"Failed to submit inquiry"},{status:400})}}a.Ry({read:a.O7().optional(),responded:a.O7().optional(),notes:a.Z_().optional()}).refine(e=>Object.keys(e).length>0,{message:"At least one field must be provided for update"});let d=(0,i.kF)(async e=>{try{let e=await o.w.query(`
      SELECT id, name, email, phone, company, subject, message, read, responded,
             "createdAt", "updatedAt"
      FROM "Inquiry"
      ORDER BY "createdAt" DESC
      `);return s.NextResponse.json(e.rows)}catch(e){return console.error("Error fetching inquiries:",e),s.NextResponse.json({error:"Failed to fetch inquiries"},{status:500})}});n()}catch(e){n(e)}})},29802:(e,r,t)=>{t.d(r,{$t:()=>c,Ax:()=>i,kF:()=>u});var n=t(30627),s=t(17261);function a(e,r={}){let{requireAuth:t=!0,allowedRoles:n,tokenType:a="user_token"}=r,o=e.cookies.get(a)?.value;if(!o)return null;let i=(0,s.W)(o);return i?n&&n.length>0&&!n.includes(i.role)?null:{username:i.username,role:i.role}:null}function o(e="Forbidden"){return n.NextResponse.json({error:e},{status:403})}function i(e){return a(e,{requireAuth:!0,allowedRoles:["admin","superadmin"],tokenType:"admin_token"})||o("Admin access required")}function u(e){return async r=>{let t=a(r,{requireAuth:!0,allowedRoles:["admin","superadmin"],tokenType:"admin_token"});return t?e(r,t):o("Admin access required")}}function c(e){return async r=>{let t=a(r,{requireAuth:!0,allowedRoles:["customer"],tokenType:"user_token"});return t?e(r,t):function(e="Unauthorized"){return n.NextResponse.json({error:e},{status:401})}("Authentication required")}}},17261:(e,r,t)=>{t.d(r,{R:()=>i,W:()=>u});var n=t(57946),s=t.n(n);let a=process.env.JWT_SECRET||"",o=process.env.JWT_EXPIRES_IN||"7d";if(!a)throw Error("JWT_SECRET environment variable must be set in production");function i(e,r="customer"){if(!a)throw Error("JWT_SECRET is not configured");return s().sign({username:e,role:r},a,{expiresIn:o})}function u(e){try{if(!a)return null;return s().verify(e,a)}catch{return null}}},83136:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.d(r,{w:()=>o});var s=t(8678),a=e([s]);if(s=(a.then?(await a)():a)[0],!process.env.DATABASE_URL)throw Error("DATABASE_URL must be set for Postgres connections");let o=new s.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}});n()}catch(e){n(e)}})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[6522,8247,7946,6415],()=>t(32815));module.exports=n})();