"use strict";(()=>{var e={};e.id=9293,e.ids=[9293],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},55461:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>d,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>l});var o=t(12085),s=t(31650),i=t(85980),u=t(83173),a=e([u]);u=(a.then?(await a)():a)[0];let p=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/inquiries/[id]/route",pathname:"/api/inquiries/[id]",filename:"route",bundlePath:"app/api/inquiries/[id]/route"},resolvedPagePath:"/home/stark/leiindias/app/api/inquiries/[id]/route.ts",nextConfigOutput:"",userland:u}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:f}=p,m="/api/inquiries/[id]/route";function d(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:l})}n()}catch(e){n(e)}})},83173:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{DELETE:()=>c,GET:()=>d,PUT:()=>p});var o=t(30627),s=t(6415),i=t(83136),u=t(29802),a=e([i]);i=(a.then?(await a)():a)[0];let l=s.Ry({read:s.O7().optional(),responded:s.O7().optional(),notes:s.Z_().optional()}).refine(e=>Object.keys(e).length>0,{message:"At least one field must be provided for update"});async function d(e,{params:r}){try{let t=(0,u.Ax)(e);if(t instanceof o.NextResponse)return t;let n=(await i.w.query(`
      SELECT id, name, email, phone, company, subject, message, read, responded,
             "createdAt", "updatedAt"
      FROM "Inquiry"
      WHERE id = $1
      LIMIT 1
      `,[r.id])).rows[0];if(!n)return o.NextResponse.json({error:"Inquiry not found"},{status:404});return o.NextResponse.json(n)}catch(e){return console.error("Error fetching inquiry:",e),o.NextResponse.json({error:"Failed to fetch inquiry"},{status:500})}}async function p(e,{params:r}){try{let t=(0,u.Ax)(e);if(t instanceof o.NextResponse)return t;let n=await e.json(),s=l.parse(n),a=(await i.w.query(`
      UPDATE "Inquiry"
      SET
        read = COALESCE($1, read),
        responded = COALESCE($2, responded),
        "updatedAt" = NOW()
      WHERE id = $3
      RETURNING id, name, email, phone, company, subject, message, read, responded,
                "createdAt", "updatedAt"
      `,[s.read??null,s.responded??null,r.id])).rows[0];if(!a)return o.NextResponse.json({error:"Inquiry not found"},{status:404});return o.NextResponse.json(a)}catch(e){if(e?.name==="ZodError")return o.NextResponse.json({error:"Validation failed",details:e.errors?.map(e=>({field:e.path.join("."),message:e.message}))},{status:400});return console.error("Error updating inquiry:",e),o.NextResponse.json({error:"Failed to update inquiry"},{status:400})}}async function c(e,{params:r}){try{let t=(0,u.Ax)(e);if(t instanceof o.NextResponse)return t;return await i.w.query(`
      DELETE FROM "Inquiry"
      WHERE id = $1
      `,[r.id]),o.NextResponse.json({message:"Inquiry deleted successfully"})}catch(e){return console.error("Error deleting inquiry:",e),o.NextResponse.json({error:"Failed to delete inquiry"},{status:500})}}n()}catch(e){n(e)}})},29802:(e,r,t)=>{t.d(r,{$t:()=>d,Ax:()=>u,kF:()=>a});var n=t(30627),o=t(17261);function s(e,r={}){let{requireAuth:t=!0,allowedRoles:n,tokenType:s="user_token"}=r,i=e.cookies.get(s)?.value;if(!i)return null;let u=(0,o.W)(i);return u?n&&n.length>0&&!n.includes(u.role)?null:{username:u.username,role:u.role}:null}function i(e="Forbidden"){return n.NextResponse.json({error:e},{status:403})}function u(e){return s(e,{requireAuth:!0,allowedRoles:["admin","superadmin"],tokenType:"admin_token"})||i("Admin access required")}function a(e){return async r=>{let t=s(r,{requireAuth:!0,allowedRoles:["admin","superadmin"],tokenType:"admin_token"});return t?e(r,t):i("Admin access required")}}function d(e){return async r=>{let t=s(r,{requireAuth:!0,allowedRoles:["customer"],tokenType:"user_token"});return t?e(r,t):function(e="Unauthorized"){return n.NextResponse.json({error:e},{status:401})}("Authentication required")}}},17261:(e,r,t)=>{t.d(r,{R:()=>u,W:()=>a});var n=t(57946),o=t.n(n);let s=process.env.JWT_SECRET||"",i=process.env.JWT_EXPIRES_IN||"7d";if(!s)throw Error("JWT_SECRET environment variable must be set in production");function u(e,r="customer"){if(!s)throw Error("JWT_SECRET is not configured");return o().sign({username:e,role:r},s,{expiresIn:i})}function a(e){try{if(!s)return null;return o().verify(e,s)}catch{return null}}},83136:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.d(r,{w:()=>i});var o=t(8678),s=e([o]);if(o=(s.then?(await s)():s)[0],!process.env.DATABASE_URL)throw Error("DATABASE_URL must be set for Postgres connections");let i=new o.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}});n()}catch(e){n(e)}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[6522,8247,7946,6415],()=>t(55461));module.exports=n})();