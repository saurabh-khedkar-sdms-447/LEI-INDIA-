"use strict";(()=>{var e={};e.id=9684,e.ids=[9684],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},63530:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>c,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>d});var n=r(12085),a=r(31650),o=r(85980),s=r(12453),u=e([s]);s=(u.then?(await u)():u)[0];let p=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/products/route",pathname:"/api/products",filename:"route",bundlePath:"app/api/products/route"},resolvedPagePath:"/home/stark/leiindias/app/api/products/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:g}=p,m="/api/products/route";function c(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:d})}i()}catch(e){i(e)}})},12453:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{GET:()=>c,POST:()=>p});var n=r(30627),a=r(83136),o=r(49770),s=r(29802),u=e([a]);async function c(e){try{let{searchParams:t}=new URL(e.url),r=Math.max(1,parseInt(t.get("page")||"1",10)||1),i=Math.min(100,Math.max(1,parseInt(t.get("limit")||"20",10)||20)),o=(r-1)*i,s=t.get("ids"),u=t.get("connectorType"),c=t.get("coding"),p=t.get("pins"),l=t.get("ipRating"),d=t.get("gender"),g=t.get("inStock"),m=t.get("search"),h=t.get("category"),f=[],$=[];if(s){let e=s.split(",").map(e=>e.trim()).filter(Boolean);if(e.length>0){let t=e.map((e,t)=>`$${$.length+t+1}`);f.push(`id IN (${t.join(",")})`),$.push(...e)}}if(u){let e=u.split(",").map(e=>e.trim()).filter(Boolean);if(e.length>0){let t=e.map((e,t)=>`$${$.length+t+1}`);f.push(`"connectorType" IN (${t.join(",")})`),$.push(...e)}}if(c){let e=c.split(",").map(e=>e.trim()).filter(Boolean);if(e.length>0){let t=e.map((e,t)=>`$${$.length+t+1}`);f.push(`coding IN (${t.join(",")})`),$.push(...e)}}if(p){let e=p.split(",").map(e=>Number(e)).filter(e=>!Number.isNaN(e));if(e.length>0){let t=e.map((e,t)=>`$${$.length+t+1}`);f.push(`pins IN (${t.join(",")})`),$.push(...e)}}if(l){let e=l.split(",").map(e=>e.trim()).filter(Boolean);if(e.length>0){let t=e.map((e,t)=>`$${$.length+t+1}`);f.push(`"ipRating" IN (${t.join(",")})`),$.push(...e)}}if(d){let e=d.split(",").map(e=>e.trim()).filter(Boolean);if(e.length>0){let t=e.map((e,t)=>`$${$.length+t+1}`);f.push(`gender IN (${t.join(",")})`),$.push(...e)}}if("true"===g&&f.push('"inStock" = true'),m){let e=`%${m.toLowerCase()}%`,t=$.length+1;f.push(`(LOWER(name) LIKE $${t} OR LOWER(sku) LIKE $${t+1} OR LOWER(description) LIKE $${t+2})`),$.push(e,e,e)}if(h){let e=$.length+1;f.push(`category ILIKE $${e}`),$.push(`%${h}%`)}let R=f.length>0?`WHERE ${f.join(" AND ")}`:"",y=await a.w.query(`
      SELECT COUNT(*)::int AS total
      FROM "Product"
      ${R}
      `,$),E=y.rows[0]?.total??0,T=[...$,i,o],k=(await a.w.query(`
      SELECT
        id, sku, name, category, description, "technicalDescription", coding, pins,
        "ipRating", gender, "connectorType", material, voltage, current,
        "temperatureRange", "wireGauge", "cableLength", price, "priceType",
        "inStock", "stockQuantity", images, "datasheetUrl",
        "createdAt", "updatedAt"
      FROM "Product"
      ${R}
      ORDER BY "createdAt" DESC
      LIMIT $${T.length-1}
      OFFSET $${T.length}
      `,T)).rows;return n.NextResponse.json({products:k,pagination:{page:r,limit:i,total:E,totalPages:Math.ceil(E/i),hasNext:r<Math.ceil(E/i),hasPrev:r>1}})}catch(e){return console.error("Error fetching products:",e),n.NextResponse.json({error:"Failed to fetch products"},{status:500})}}a=(u.then?(await u)():u)[0];let p=(0,s.kF)(async e=>{try{let t=await e.json(),r=o.I.parse(t),i=await a.w.query(`
      INSERT INTO "Product" (
        sku, name, category, description, "technicalDescription",
        coding, pins, "ipRating", gender, "connectorType",
        material, voltage, current, "temperatureRange",
        "wireGauge", "cableLength", price, "priceType",
        "inStock", "stockQuantity", images, "datasheetUrl",
        "createdAt", "updatedAt"
      )
      VALUES (
        $1, $2, $3, $4, $5,
        $6, $7, $8, $9, $10,
        $11, $12, $13, $14,
        $15, $16, $17, $18,
        $19, $20, $21, $22,
        NOW(), NOW()
      )
      RETURNING
        id, sku, name, category, description, "technicalDescription",
        coding, pins, "ipRating", gender, "connectorType",
        material, voltage, current, "temperatureRange",
        "wireGauge", "cableLength", price, "priceType",
        "inStock", "stockQuantity", images, "datasheetUrl",
        "createdAt", "updatedAt"
      `,[r.sku,r.name,r.category,r.description,r.technicalDescription,r.coding,r.pins,r.ipRating,r.gender,r.connectorType,r.specifications.material,r.specifications.voltage,r.specifications.current,r.specifications.temperatureRange,r.specifications.wireGauge??null,r.specifications.cableLength??null,r.price??null,r.priceType,r.inStock,r.stockQuantity??null,r.images,r.datasheetUrl??null]);return n.NextResponse.json(i.rows[0],{status:201})}catch(e){if(e?.name==="ZodError")return n.NextResponse.json({error:"Validation failed",details:e.errors?.map(e=>({field:e.path.join("."),message:e.message}))},{status:400});return console.error("Error creating product:",e),n.NextResponse.json({error:"Failed to create product"},{status:400})}});i()}catch(e){i(e)}})},29802:(e,t,r)=>{r.d(t,{$t:()=>c,Ax:()=>s,kF:()=>u});var i=r(30627),n=r(17261);function a(e,t={}){let{requireAuth:r=!0,allowedRoles:i,tokenType:a="user_token"}=t,o=e.cookies.get(a)?.value;if(!o)return null;let s=(0,n.W)(o);return s?i&&i.length>0&&!i.includes(s.role)?null:{username:s.username,role:s.role}:null}function o(e="Forbidden"){return i.NextResponse.json({error:e},{status:403})}function s(e){return a(e,{requireAuth:!0,allowedRoles:["admin","superadmin"],tokenType:"admin_token"})||o("Admin access required")}function u(e){return async t=>{let r=a(t,{requireAuth:!0,allowedRoles:["admin","superadmin"],tokenType:"admin_token"});return r?e(t,r):o("Admin access required")}}function c(e){return async t=>{let r=a(t,{requireAuth:!0,allowedRoles:["customer"],tokenType:"user_token"});return r?e(t,r):function(e="Unauthorized"){return i.NextResponse.json({error:e},{status:401})}("Authentication required")}}},17261:(e,t,r)=>{r.d(t,{R:()=>s,W:()=>u});var i=r(57946),n=r.n(i);let a=process.env.JWT_SECRET||"",o=process.env.JWT_EXPIRES_IN||"7d";if(!a)throw Error("JWT_SECRET environment variable must be set in production");function s(e,t="customer"){if(!a)throw Error("JWT_SECRET is not configured");return n().sign({username:e,role:t},a,{expiresIn:o})}function u(e){try{if(!a)return null;return n().verify(e,a)}catch{return null}}},83136:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{w:()=>o});var n=r(8678),a=e([n]);if(n=(a.then?(await a)():a)[0],!process.env.DATABASE_URL)throw Error("DATABASE_URL must be set for Postgres connections");let o=new n.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}});i()}catch(e){i(e)}})},49770:(e,t,r)=>{r.d(t,{I:()=>n,r:()=>a});var i=r(6415);let n=i.Ry({sku:i.Z_().min(1,"SKU is required").trim(),name:i.Z_().min(1,"Product name is required").trim(),category:i.Z_().min(1,"Category is required").trim(),description:i.Z_().min(1,"Description is required"),technicalDescription:i.Z_().min(1,"Technical description is required"),coding:i.Km(["A","B","D","X"],{errorMap:()=>({message:"Coding must be A, B, D, or X"})}),pins:i.G0([i.i0(3),i.i0(4),i.i0(5),i.i0(8),i.i0(12)],{errorMap:()=>({message:"Pins must be 3, 4, 5, 8, or 12"})}),ipRating:i.Km(["IP67","IP68","IP20"],{errorMap:()=>({message:"IP Rating must be IP67, IP68, or IP20"})}),gender:i.Km(["Male","Female"],{errorMap:()=>({message:"Gender must be Male or Female"})}),connectorType:i.Km(["M12","M8","RJ45"],{errorMap:()=>({message:"Connector type must be M12, M8, or RJ45"})}),specifications:i.Ry({material:i.Z_().min(1,"Material is required"),voltage:i.Z_().min(1,"Voltage is required"),current:i.Z_().min(1,"Current is required"),temperatureRange:i.Z_().min(1,"Temperature range is required"),wireGauge:i.Z_().optional(),cableLength:i.Z_().optional()}),price:i.Rx().positive().optional(),priceType:i.Km(["fixed","quote"]).default("quote"),inStock:i.O7().default(!0),stockQuantity:i.Rx().int().positive().optional(),images:i.IX(i.Z_()).default([]),datasheetUrl:i.Z_().url().optional().or(i.i0("")),relatedProducts:i.IX(i.Z_()).optional()}),a=n.partial()}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[6522,8247,7946,6415],()=>r(63530));module.exports=i})();